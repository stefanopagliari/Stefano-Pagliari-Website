<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Long vs. Wide Data | IP2038 - Analysing Political and Economic Data in the Real World - Course Material</title>
<meta name="author" content="Stefano Pagliari">
<meta name="description" content="6.1 Long vs. Wide Data Tabular data can be arranged in many ways.For instance the data below displays information on the gdp growth of different countries in different years. All these datasets...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 6 Long vs. Wide Data | IP2038 - Analysing Political and Economic Data in the Real World - Course Material">
<meta property="og:type" content="book">
<meta property="og:description" content="6.1 Long vs. Wide Data Tabular data can be arranged in many ways.For instance the data below displays information on the gdp growth of different countries in different years. All these datasets...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 6 Long vs. Wide Data | IP2038 - Analysing Political and Economic Data in the Real World - Course Material">
<meta name="twitter:description" content="6.1 Long vs. Wide Data Tabular data can be arranged in many ways.For instance the data below displays information on the gdp growth of different countries in different years. All these datasets...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">IP2038 - Analysing Political and Economic Data in the Real World - Course Material</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction to the Module</a></li>
<li class="book-part">Introduction to R</li>
<li><a class="" href="rstudio-and-rstudio-cloud.html"><span class="header-section-number">2</span> RStudio and RStudio Cloud</a></li>
<li><a class="" href="getting-started-with-r.html"><span class="header-section-number">3</span> Getting Started with R</a></li>
<li class="book-part">Datasets</li>
<li><a class="" href="importing-data-into-r.html"><span class="header-section-number">4</span> Importing Data into R</a></li>
<li><a class="" href="inspecting-a-dataset.html"><span class="header-section-number">5</span> Inspecting a Dataset</a></li>
<li><a class="active" href="long-vs.-wide-data.html"><span class="header-section-number">6</span> Long vs. Wide Data</a></li>
<li><a class="" href="list-of-political-and-economic-datasets.html"><span class="header-section-number">7</span> List of Political and Economic Datasets</a></li>
<li class="book-part">Data Wrangling</li>
<li><a class="" href="data-wrangling-with-dplyr.html"><span class="header-section-number">8</span> Data Wrangling with dplyr</a></li>
<li><a class="" href="working-with-observations.html"><span class="header-section-number">9</span> Working with Observations</a></li>
<li><a class="" href="working-with-variables.html"><span class="header-section-number">10</span> Working with Variables</a></li>
<li><a class="" href="grouping-and-summarising-data.html"><span class="header-section-number">11</span> Grouping and Summarising Data</a></li>
<li><a class="" href="relational-data.html"><span class="header-section-number">12</span> Relational Data</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">13</span> Missing Data</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="" href="data-visualization-with-ggplot.html"><span class="header-section-number">14</span> Data Visualization with ggplot</a></li>
<li><a class="" href="types-of-visualizations.html"><span class="header-section-number">15</span> Types of visualizations</a></li>
<li class="book-part">Exploratory Analysis</li>
<li><a class="" href="exploring-numerical-data.html"><span class="header-section-number">16</span> Exploring Numerical Data</a></li>
<li><a class="" href="exploring-categorical-data.html"><span class="header-section-number">17</span> Exploring Categorical Data</a></li>
<li><a class="" href="relationship-between-categorical-and-numerical-variables.html"><span class="header-section-number">18</span> Relationship between categorical and numerical variables</a></li>
<li><a class="" href="relationship-between-numerical-variables.html"><span class="header-section-number">19</span> Relationship between numerical variables</a></li>
<li><a class="" href="relationship-between-categorical-variables.html"><span class="header-section-number">20</span> Relationship between categorical variables</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">21</span> Time Series</a></li>
<li><a class="" href="maps.html"><span class="header-section-number">22</span> Maps</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="assessment-guidance.html"><span class="header-section-number">A</span> Assessment Guidance</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="long-vs.-wide-data" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Long vs. Wide Data<a class="anchor" aria-label="anchor" href="#long-vs.-wide-data"><i class="fas fa-link"></i></a>
</h1>
<div id="long-vs.-wide-data-1" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Long vs. Wide Data<a class="anchor" aria-label="anchor" href="#long-vs.-wide-data-1"><i class="fas fa-link"></i></a>
</h2>
<p>Tabular data can be arranged in many ways.For instance the data below displays information on the gdp growth of different countries in different years. All these datasets captures the same information in 9 observations (Morocco in 2017, Morocco in 2018, Morocco in 2019, Finland in 2017, Finland in 2018, Finland in 2019, Pakistan in 2017, Pakistan in 2018, Pakistan in 2019) but the data are organized differently in each table.</p>
<p>In the first table, each country (observation) is on a different row and different years are placed in different columns.</p>
<pre><code>#&gt;       name GDP_2017 GDP_2018 GDP_2019
#&gt; 1  Morocco      4.2      3.1      2.6
#&gt; 2  Finland      3.1      1.1      1.2
#&gt; 3 Pakistan      5.5      5.8      1.4</code></pre>
<p>In the second table, each columns indicate a different variable (country, year, gdp) and each observation is in a different row.</p>
<pre><code>#&gt;       name year GDP
#&gt; 1  Morocco 2017 4.2
#&gt; 2  Morocco 2018 3.1
#&gt; 3  Morocco 2019 2.6
#&gt; 4  Finland 2017 3.1
#&gt; 5  Finland 2018 1.1
#&gt; 6  Finland 2019 1.2
#&gt; 7 Pakistan 2017 5.5
#&gt; 8 Pakistan 2018 5.8
#&gt; 9 Pakistan 2019 1.4</code></pre>
<p>These different data structures are often referred to “longer” vs. “wider” format.
The first table is an example of a wide-format table. Here some variables (year) are spread out across columns. This is the most compact form to present the data in table and often the preferable format to show to the reader the numbers.</p>
<p>In a long-format table (the second one above), the data is not presented in the most compact form. Nonetheless this format is often preferred when it comes to analyze and visualize the data.</p>
<p>This long format is often referred to as a ‘tidy format’ (<a href="http://www.jstatsoft.org/v59/i10/paper">Wickham 2014</a>). From this perspective</p>
<ul>
<li>each column represents a single measurement type</li>
<li>each row represents a single observation</li>
<li>each cell contains a single value</li>
</ul>
<div class="inline-figure"><img src="images/tidy-data-summary.png" style="width:90.0%"></div>
<p>Some of the main packages we will use in this course (dplyr, ggplot2, and all the other packages in the tidyverse) are designed to handle data that is organized in this format.</p>
<p>Unfortunately, most of the real world datasets are not in this format. Data is often organised to facilitate some use other than analysis, for instance to facilitate data entry. As a result, it is common for one variable to be spread across multiple columns, or one observation to be scattered across multiple rows.</p>
<p>The <code>tidyr</code> package (part of the tidyverse) includes a series of functions designed to help users to convert data into a ‘tidy format’. In particular, the two most important functions in tidyr to reshape the data are: <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code>.</p>
</div>
<div id="reshaping-the-data-from-wide-to-long" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Reshaping the data from wide to long<a class="anchor" aria-label="anchor" href="#reshaping-the-data-from-wide-to-long"><i class="fas fa-link"></i></a>
</h2>
<p>A common problem when analyzing real world datasets is the case when some of the column names are not names of variables, but values of a variable. This is often the preferred format to visually compare the differences across different groups but it not necessarily the best format in terms of ease of analysis.</p>
<p>mm In the one on the right, the variable capturing the year of the observation is spread across different columns, one for each year.</p>
<p>In order to more easily manipulate these datasets with dplyr and visualize them with ggplot we would need to reshape these columns into a new pair of variables (<code>year</code> and <code>cases</code>) like in the example on the left:</p>
<div class="inline-figure"><img src="images/tidy-vs-untidy-table.png" style="width:80.0%"></div>
<p>The function <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> (from the <code>tidyr</code> package, part of the <code>tidyverse</code>) makes datasets longer by increasing the number of rows and decreasing the number of columns.</p>
<p><code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> takes three commands, specifying</p>
<ul>
<li>
<code>cols =</code>: a vector of the names of the columns that need to be reshaped and converted to values in long form. Importantly, in cases where there mant column names to convert to long format, it is simpler to use cols = to specify those columns that we don’t want to convert, which are usually the left-most columns. This is done with the <code>-</code> symbol</li>
<li>
<code>names_to =</code>: a name for the new column containing the names from <code>cols</code>. The new column names need to be in quotes.</li>
<li>
<code>values_to =</code>: a name for the new column containing the values corresponding to <code>cols</code>. The new column names need to be in quotes</li>
</ul>
<p>So for the figure above, to convert from the left table (table4b) to the long table at right, would require:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table4a</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`1999`</span>, <span class="va">`2000`</span><span class="op">)</span>, 
               names_to <span class="op">=</span> <span class="st">"year"</span>, 
               values_to <span class="op">=</span> <span class="st">"cases"</span><span class="op">)</span></code></pre></div>
<p>In this case:</p>
<ul>
<li>The first argument provided (cols = c(<code>1999</code>, <code>2000</code>)) indicates what columns need to be reshaped. In this case it is two separate columns, whicih therefore need to be included in a vector</li>
<li>The second argument (<code>names_to = "year"</code>) indicates the name of the variable that will be created from the data in the column names, in this case <code>year</code>
</li>
<li>The third argument (<code>values_to = "cases"</code>) indicates the name of the variable that will be created from the data stored in the cell value, in this case <code>cases</code>
</li>
</ul>
<p>Another example of a dataset that may need to be transformned from a wider to a longer format is the dataset <code>relig_income</code> (preloaded with the package <code>tidyr</code>). This is based on a survey which asked people about their religion and annual income.
This dataset contains three variables:</p>
<ul>
<li>
<em>religion</em>: stored in the rows,</li>
<li>
<em>income</em>: spread across the column names, and</li>
<li>
<em>count</em>: stored in the cell values.</li>
</ul>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">relig_income</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 11</span>
<span class="co">#&gt;   religion   `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k`</span>
<span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Agnostic        27        34        60        81        76</span>
<span class="co">#&gt; 2 Atheist         12        27        37        52        35</span>
<span class="co">#&gt; 3 Buddhist        27        21        30        34        33</span>
<span class="co">#&gt; 4 Catholic       418       617       732       670       638</span>
<span class="co">#&gt; 5 Don’t kno…      15        14        15        11        10</span>
<span class="co">#&gt; 6 Evangelic…     575       869      1064       982       881</span>
<span class="co">#&gt; # … with 5 more variables: $50-75k &lt;dbl&gt;, $75-100k &lt;dbl&gt;,</span>
<span class="co">#&gt; #   $100-150k &lt;dbl&gt;, &gt;150k &lt;dbl&gt;, Don't know/refused &lt;dbl&gt;</span></code></pre></div>
<p>To facilitate the analysis we can ‘tidy’ this dataset using <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>.</p>
<ul>
<li>The first argument provided (<code>-religion</code>) indicates what columns need to be reshaped. In this case it is every column apart from <code>religion</code>
</li>
<li>The second argument (<code>names_to = "income"</code>) indicates the name of the variable that will be created from the data in the column names, in this case <code>income</code>
</li>
<li>The third argument (<code>values_to = "count"</code>) indicates the name of the variable that will be created from the data stored in the cell value, in this case <code>count</code>
</li>
</ul>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">relig_income</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">religion</span>, 
               names_to <span class="op">=</span> <span class="st">"income"</span>, 
               values_to <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 180 × 3</span>
<span class="co">#&gt;    religion income             count</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Agnostic &lt;$10k                 27</span>
<span class="co">#&gt;  2 Agnostic $10-20k               34</span>
<span class="co">#&gt;  3 Agnostic $20-30k               60</span>
<span class="co">#&gt;  4 Agnostic $30-40k               81</span>
<span class="co">#&gt;  5 Agnostic $40-50k               76</span>
<span class="co">#&gt;  6 Agnostic $50-75k              137</span>
<span class="co">#&gt;  7 Agnostic $75-100k             122</span>
<span class="co">#&gt;  8 Agnostic $100-150k            109</span>
<span class="co">#&gt;  9 Agnostic &gt;150k                 84</span>
<span class="co">#&gt; 10 Agnostic Don't know/refused    96</span>
<span class="co">#&gt; # … with 170 more rows</span></code></pre></div>
<p>Once the data is reshaped in this format is it easier to visualize it using ggplot. For instance, the code below reshapes the dataset from a wide to a long format and it then passes this data to ggplot to map the prevalence of different religion within each income group.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">relig_income_longer</span> <span class="op">&lt;-</span> <span class="va">relig_income</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">religion</span>, 
               names_to <span class="op">=</span> <span class="st">"income"</span>, 
               values_to <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>income <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">income</span>, 
                              <span class="st">"&lt;$10k"</span>,
                              <span class="st">"$10-20k"</span>,
                              <span class="st">"$20-30k"</span>,
                              <span class="st">"$30-40k"</span>,
                              <span class="st">"$40-50k"</span>,
                              <span class="st">"$50-75k"</span>,
                              <span class="st">"$75-100k"</span>,
                              <span class="st">"$100-150k"</span>,
                              <span class="st">"&gt;150k"</span>  
                              <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#Change the order of the values in the income</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">income</span> <span class="op">!=</span> <span class="st">"Don't know/refused"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">religion</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Atheist"</span>, <span class="st">"Jewish"</span>, <span class="st">"Muslim"</span>, <span class="st">"Catholic"</span>, <span class="st">"Mainline Prot"</span>, <span class="st">"Other Christian"</span>, <span class="st">"Evangelical Prot"</span>, <span class="st">"Mormon"</span><span class="op">)</span><span class="op">)</span>


  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">relig_income_longer</span>,
         mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">income</span>,
                       y <span class="op">=</span> <span class="va">count</span>,
                       fill <span class="op">=</span> <span class="va">religion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span> <span class="op">(</span>title <span class="op">=</span> <span class="st">"Income Level Across Religious Groups"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="5_Reshaping_Data_files/figure-html/unnamed-chunk-7-1.png" width="672"></div>
</div>
<div id="reshaping-the-data-from-long-to-wide" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Reshaping the data from long to wide<a class="anchor" aria-label="anchor" href="#reshaping-the-data-from-long-to-wide"><i class="fas fa-link"></i></a>
</h2>
<p>While reshaping a dataset from a wider to a longer format with <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> is needed when some of the column names are values of a variable, in some cases the opposite transformation is needed. This is in particular when an observation is spread across multiple rows.</p>
<div class="inline-figure"><img src="images/narrow_to_wide.png" style="width:80.0%"></div>
<p>For instance, the table on the left (from Wickham and Grolemund) contains information on the <code>cases</code> and <code>population</code> different different countries in different years, but each country/year observation is found in two different rows.</p>
<div class="inline-figure"><img src="images/long_wide.png" style="width:80.0%"></div>
<p>The function <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> can be used to “widen” the dataset by increasing the number of columns and decreasing the number of observations. It does so by converting the values in one column into new columns names.<br>
It’s relatively rare to need pivot_wider() to make tidy data, but it’s often useful for creating summary tables for presentation, or data in a format needed by other tools.</p>
<p><code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> requires two commands, both of which are column names in the original table.</p>
<ul>
<li>
<code>names_from</code> indicates the column containing the labels which will become the new column names.</li>
<li>
<code>values from</code> indicates the column containing the values that will populate the the new</li>
</ul>
<p>To illustrate this change, we can observe the <code>us_rent_income</code> dataset. This dataset includes information from the 2017 American Community Survey regarding the US rent and income data that is pre-loaded when the tidyverse is loaded on your work environment.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">us_rent_income</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 5</span>
<span class="co">#&gt;   GEOID NAME    variable estimate   moe</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 01    Alabama income      24476   136</span>
<span class="co">#&gt; 2 01    Alabama rent          747     3</span>
<span class="co">#&gt; 3 02    Alaska  income      32940   508</span>
<span class="co">#&gt; 4 02    Alaska  rent         1200    13</span>
<span class="co">#&gt; 5 04    Arizona income      27517   148</span>
<span class="co">#&gt; 6 04    Arizona rent          972     4</span></code></pre></div>
<p>When we observe the dataset, we can see that the column named <code>variable</code> has two values: <code>income</code> and <code>rent</code>. Both the column <code>estimate</code> (estimated value) and the column <code>moe</code> (90% margin of error) include values for both of income and rent in different American states.</p>
<p>To transform the illustrative table above at left (<code>df_long</code>) into the result at right, would require:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">us_rent_income</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>
    names_from <span class="op">=</span> <span class="va">variable</span>,
    values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">estimate</span>, <span class="va">moe</span><span class="op">)</span>
  <span class="op">)</span>
<span class="co">#&gt; # A tibble: 52 × 6</span>
<span class="co">#&gt;    GEOID NAME       estimate_income estimate_rent moe_income</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;                &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 01    Alabama              24476           747        136</span>
<span class="co">#&gt;  2 02    Alaska               32940          1200        508</span>
<span class="co">#&gt;  3 04    Arizona              27517           972        148</span>
<span class="co">#&gt;  4 05    Arkansas             23789           709        165</span>
<span class="co">#&gt;  5 06    California           29454          1358        109</span>
<span class="co">#&gt;  6 08    Colorado             32401          1125        109</span>
<span class="co">#&gt;  7 09    Connectic…           35326          1123        195</span>
<span class="co">#&gt;  8 10    Delaware             31560          1076        247</span>
<span class="co">#&gt;  9 11    District …           43198          1424        681</span>
<span class="co">#&gt; 10 12    Florida              25952          1077         70</span>
<span class="co">#&gt; # … with 42 more rows, and 1 more variable: moe_rent &lt;dbl&gt;</span></code></pre></div>
<p>In this case, since there are two different columns with the values to be added to <code>values_from</code>, these need to be included inside a vector <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>.</p>
<p>This transformation increase the number of columns, replacing the column <code>estimate</code> with two distinct columns (<code>estimate_rent</code> and <code>estimate_income</code>), each of them including the values of the estimated value of rent and income in a specific state, and replacing the column <code>moe</code> with two distinct columns (<code>moe_rent</code> and <code>moe_income</code>).</p>
<p>The name of the new columns automatically combines the values found in the column listed in <code>names from</code> (income, rent) with the name of the variables listed in <code>values from</code> (estimate, moe). It is possible to change how this name is constructed by specifying the parameter <code>names_sep</code>.</p>
</div>
<div id="reshape-longer-then-wider" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Reshape longer, then wider<a class="anchor" aria-label="anchor" href="#reshape-longer-then-wider"><i class="fas fa-link"></i></a>
</h2>
<p>In some cases, datasets need to be repshaped both from wide to long format and vice versa. This example from the <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/pivot.html">documentation</a> of pivot_longer() and pivot_wider() show how you might combine both functions to solve more complex problems.</p>
<p>The <code>world_bank_pop</code> (preloaded with the tidyverse) contains data from the World Bank about population per country from 2000 to 2018.A glimpse at the data reveals that the values for the population of a country in a given year are stored in different variables, one for each year.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">world_bank_pop</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 20</span>
<span class="co">#&gt;   country indicator    `2000`  `2001`  `2002` `2003`  `2004`</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 ABW     SP.URB.TOTL  4.24e4  4.30e4  4.37e4 4.42e4 4.47e+4</span>
<span class="co">#&gt; 2 ABW     SP.URB.GROW  1.18e0  1.41e0  1.43e0 1.31e0 9.51e-1</span>
<span class="co">#&gt; 3 ABW     SP.POP.TOTL  9.09e4  9.29e4  9.50e4 9.70e4 9.87e+4</span>
<span class="co">#&gt; 4 ABW     SP.POP.GROW  2.06e0  2.23e0  2.23e0 2.11e0 1.76e+0</span>
<span class="co">#&gt; 5 AFG     SP.URB.TOTL  4.44e6  4.65e6  4.89e6 5.16e6 5.43e+6</span>
<span class="co">#&gt; 6 AFG     SP.URB.GROW  3.91e0  4.66e0  5.13e0 5.23e0 5.12e+0</span>
<span class="co">#&gt; # … with 13 more variables: 2005 &lt;dbl&gt;, 2006 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   2007 &lt;dbl&gt;, 2008 &lt;dbl&gt;, 2009 &lt;dbl&gt;, 2010 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   2011 &lt;dbl&gt;, 2012 &lt;dbl&gt;, 2013 &lt;dbl&gt;, 2014 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   2015 &lt;dbl&gt;, 2016 &lt;dbl&gt;, 2017 &lt;dbl&gt;</span></code></pre></div>
<p>We can reshape this dataset with <code>pivot_longer</code> in order to bring the value of the population variable in a single column. In this case, instead of manually listing all the columns to be reshaped, we can indicate the range of names (<code>2000</code>:<code>2017</code>)</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pop2</span> <span class="op">&lt;-</span> <span class="va">world_bank_pop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">`2000`</span><span class="op">:</span><span class="va">`2017`</span>, 
               names_to <span class="op">=</span> <span class="st">"year"</span>, 
               values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span>
<span class="va">pop2</span>
<span class="co">#&gt; # A tibble: 19,008 × 4</span>
<span class="co">#&gt;    country indicator   year  value</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 ABW     SP.URB.TOTL 2000  42444</span>
<span class="co">#&gt;  2 ABW     SP.URB.TOTL 2001  43048</span>
<span class="co">#&gt;  3 ABW     SP.URB.TOTL 2002  43670</span>
<span class="co">#&gt;  4 ABW     SP.URB.TOTL 2003  44246</span>
<span class="co">#&gt;  5 ABW     SP.URB.TOTL 2004  44669</span>
<span class="co">#&gt;  6 ABW     SP.URB.TOTL 2005  44889</span>
<span class="co">#&gt;  7 ABW     SP.URB.TOTL 2006  44881</span>
<span class="co">#&gt;  8 ABW     SP.URB.TOTL 2007  44686</span>
<span class="co">#&gt;  9 ABW     SP.URB.TOTL 2008  44375</span>
<span class="co">#&gt; 10 ABW     SP.URB.TOTL 2009  44052</span>
<span class="co">#&gt; # … with 18,998 more rows</span></code></pre></div>
<p>The newly created <code>value</code> columns however still contains different variables that are listed in the <code>indicator</code> column. This includes four different values:</p>
<ul>
<li>SP.POP.GROW is population growth,</li>
<li>SP.POP.TOTL is total population,</li>
<li>SP.URB.GROW is population growth for urban areas</li>
<li>SP.URB.TOTL is total population for urban areas</li>
</ul>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pop2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">indicator</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4 × 2</span>
<span class="co">#&gt;   indicator       n</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt;</span>
<span class="co">#&gt; 1 SP.POP.GROW  4752</span>
<span class="co">#&gt; 2 SP.POP.TOTL  4752</span>
<span class="co">#&gt; 3 SP.URB.GROW  4752</span>
<span class="co">#&gt; 4 SP.URB.TOTL  4752</span></code></pre></div>
<p>Since these represent different quantities observed for the same observation (country/year), we can use <code>pivot_wider</code> to split the different types of population count across four different variables.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pop3</span> <span class="op">&lt;-</span> <span class="va">pop2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">indicator</span>, values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span>

<span class="va">pop3</span>
<span class="co">#&gt; # A tibble: 4,752 × 6</span>
<span class="co">#&gt;    country year  SP.URB.TOTL SP.URB.GROW SP.POP.TOTL</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1 ABW     2000        42444      1.18         90853</span>
<span class="co">#&gt;  2 ABW     2001        43048      1.41         92898</span>
<span class="co">#&gt;  3 ABW     2002        43670      1.43         94992</span>
<span class="co">#&gt;  4 ABW     2003        44246      1.31         97017</span>
<span class="co">#&gt;  5 ABW     2004        44669      0.951        98737</span>
<span class="co">#&gt;  6 ABW     2005        44889      0.491       100031</span>
<span class="co">#&gt;  7 ABW     2006        44881     -0.0178      100832</span>
<span class="co">#&gt;  8 ABW     2007        44686     -0.435       101220</span>
<span class="co">#&gt;  9 ABW     2008        44375     -0.698       101353</span>
<span class="co">#&gt; 10 ABW     2009        44052     -0.731       101453</span>
<span class="co">#&gt; # … with 4,742 more rows, and 1 more variable:</span>
<span class="co">#&gt; #   SP.POP.GROW &lt;dbl&gt;</span></code></pre></div>
<p>It is now possible to plot the data. For instance, the figure below plots the evolution in the growth of the urban population in China.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pop3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"CHN"</span><span class="op">)</span>,
       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>,
                     y <span class="op">=</span> <span class="va">SP.URB.GROW</span>,
                     group <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Population Growth in the Urban Areas of China"</span>,
       x <span class="op">=</span> <span class="st">"Year"</span>,
       y <span class="op">=</span> <span class="st">"% Growth"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="5_Reshaping_Data_files/figure-html/unnamed-chunk-14-1.png" width="672"></div>
</div>
<div id="separating-and-uniting-columns" class="section level2" number="6.5">
<h2>
<span class="header-section-number">6.5</span> Separating and Uniting Columns<a class="anchor" aria-label="anchor" href="#separating-and-uniting-columns"><i class="fas fa-link"></i></a>
</h2>
<div id="separate" class="section level3" number="6.5.1">
<h3>
<span class="header-section-number">6.5.1</span> Separate()<a class="anchor" aria-label="anchor" href="#separate"><i class="fas fa-link"></i></a>
</h3>
<p>As we have seen above <code>pivot_longer</code> is used when colum names include values, and <code>pivot_wider</code> when observations are spread across multiple rows. A different type of issue when it comes to analyzing real world dataset comes those cases when a column includes multiple values or when a value is spread across columns.</p>
<p>The function <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> can be used to divide a column into multiple columns. The values in that column will be split when the function identifies a non-alphanumeric separator character (e.g. “/”, “-”).</p>
<p>The function takes three values:</p>
<ul>
<li>
<code>col =</code>: the title of the column containing multiple values that need to be split</li>
<li>
<code>into = c()</code>: a vector containing the name of the two or more columns to be created</li>
<li>
<code>sep =</code>: it is possible to specify what character should be used to separate the values. If this is not specified, the function will split the values at the forward slash since this is the first non-alphanumeric character found.</li>
</ul>
<p>The table below on the left (from Wickham and Grolemund) shows an example where the column <code>rate</code> provides two different values, the numerator and the denominator, separated by a “/”.</p>
<div class="inline-figure"><img src="images/Separate_Example.png" style="width:80.0%"></div>
<p>We can split the values in the <code>rate</code> column across two different columns by using the <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> function.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">rate</span>, 
           into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span>, 
           sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 4</span>
<span class="co">#&gt;   country      year cases  population</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     </span>
<span class="co">#&gt; 1 Afghanistan  1999 745    19987071  </span>
<span class="co">#&gt; 2 Afghanistan  2000 2666   20595360  </span>
<span class="co">#&gt; 3 Brazil       1999 37737  172006362 </span>
<span class="co">#&gt; 4 Brazil       2000 80488  174504898 </span>
<span class="co">#&gt; 5 China        1999 212258 1272915272</span>
<span class="co">#&gt; 6 China        2000 213766 1280428583</span></code></pre></div>
</div>
<div id="unite" class="section level3" number="6.5.2">
<h3>
<span class="header-section-number">6.5.2</span> Unite()<a class="anchor" aria-label="anchor" href="#unite"><i class="fas fa-link"></i></a>
</h3>
<p>While <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> can be used to split a column into multiple ones, `unite() can be used to combine multiple columns into a single one when the data is split.</p>
<p>The figure below provides an example from (from Wickham and Grolemund) where the date is split into two different column, one for the century and the other for the year.
We can use <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> to rejoin the century and year columns into a single one.</p>
<div class="inline-figure"><img src="images/tidyr-unite.png" style="width:80.0%"></div>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="va">new</span>, <span class="va">century</span>, <span class="va">year</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 3</span>
<span class="co">#&gt;   country     new   rate             </span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;            </span>
<span class="co">#&gt; 1 Afghanistan 19_99 745/19987071     </span>
<span class="co">#&gt; 2 Afghanistan 20_00 2666/20595360    </span>
<span class="co">#&gt; 3 Brazil      19_99 37737/172006362  </span>
<span class="co">#&gt; 4 Brazil      20_00 80488/174504898  </span>
<span class="co">#&gt; 5 China       19_99 212258/1272915272</span>
<span class="co">#&gt; 6 China       20_00 213766/1280428583</span></code></pre></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="inspecting-a-dataset.html"><span class="header-section-number">5</span> Inspecting a Dataset</a></div>
<div class="next"><a href="list-of-political-and-economic-datasets.html"><span class="header-section-number">7</span> List of Political and Economic Datasets</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#long-vs.-wide-data"><span class="header-section-number">6</span> Long vs. Wide Data</a></li>
<li><a class="nav-link" href="#long-vs.-wide-data-1"><span class="header-section-number">6.1</span> Long vs. Wide Data</a></li>
<li><a class="nav-link" href="#reshaping-the-data-from-wide-to-long"><span class="header-section-number">6.2</span> Reshaping the data from wide to long</a></li>
<li><a class="nav-link" href="#reshaping-the-data-from-long-to-wide"><span class="header-section-number">6.3</span> Reshaping the data from long to wide</a></li>
<li><a class="nav-link" href="#reshape-longer-then-wider"><span class="header-section-number">6.4</span> Reshape longer, then wider</a></li>
<li>
<a class="nav-link" href="#separating-and-uniting-columns"><span class="header-section-number">6.5</span> Separating and Uniting Columns</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#separate"><span class="header-section-number">6.5.1</span> Separate()</a></li>
<li><a class="nav-link" href="#unite"><span class="header-section-number">6.5.2</span> Unite()</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>IP2038 - Analysing Political and Economic Data in the Real World - Course Material</strong>" was written by Stefano Pagliari. It was last built on 2022-04-02.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
