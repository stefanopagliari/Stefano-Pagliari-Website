<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Data Transformation with dplyr() | IP2038 - Analysing Political and Economic Data in the Real World - Course Material</title>
<meta name="author" content="Stefano Pagliari">
<meta name="description" content="Data wrangling - also called data cleaning, data remediation, or data munging - refers to a variety of processes designed to transform raw data into more readily used formats. Indeed, this is a...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 6 Data Transformation with dplyr() | IP2038 - Analysing Political and Economic Data in the Real World - Course Material">
<meta property="og:type" content="book">
<meta property="og:description" content="Data wrangling - also called data cleaning, data remediation, or data munging - refers to a variety of processes designed to transform raw data into more readily used formats. Indeed, this is a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 6 Data Transformation with dplyr() | IP2038 - Analysing Political and Economic Data in the Real World - Course Material">
<meta name="twitter:description" content="Data wrangling - also called data cleaning, data remediation, or data munging - refers to a variety of processes designed to transform raw data into more readily used formats. Indeed, this is a...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.10/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">IP2038 - Analysing Political and Economic Data in the Real World - Course Material</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction to the Module</a></li>
<li><a class="" href="rstudio-and-rstudio-cloud.html"><span class="header-section-number">2</span> RStudio and RStudio Cloud</a></li>
<li><a class="" href="getting-started-with-r.html"><span class="header-section-number">3</span> Getting Started with R</a></li>
<li><a class="" href="importing-data-into-r.html"><span class="header-section-number">4</span> Importing Data into R</a></li>
<li><a class="" href="inspecting-a-dataset.html"><span class="header-section-number">5</span> Inspecting a Dataset</a></li>
<li><a class="active" href="data-transformation-with-dplyr.html"><span class="header-section-number">6</span> Data Transformation with dplyr()</a></li>
<li><a class="" href="missing-values.html"><span class="header-section-number">7</span> Missing Values</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="list-of-datasets.html"><span class="header-section-number">A</span> List of Datasets</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data-transformation-with-dplyr" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Data Transformation with dplyr()<a class="anchor" aria-label="anchor" href="#data-transformation-with-dplyr"><i class="fas fa-link"></i></a>
</h1>
<p>Data wrangling - also called data cleaning, data remediation, or data munging - refers to a variety of processes designed to transform raw data into more readily used formats.
Indeed, this is a key step when dealing with real-word datasets, since these often do not present the information in the precise way that is relevant to our analysis. Often most of the time in the process of analysing data is spent in manipualting and cleaning the data.</p>
<div class="inline-figure"><img src="images/Data_Wrangling_From_Messy_To_Clean_Data_Management.jpg" style="width:80.0%"></div>
<div id="dplyr" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Dplyr<a class="anchor" aria-label="anchor" href="#dplyr"><i class="fas fa-link"></i></a>
</h2>
<p><code>Dplyr</code> is a package (part of the <code>tidyverse</code>) which includes a number of helpful functions that can be used to manipulate our data in order to transform it into a more helpful format.</p>
<div class="inline-figure"><img src="images/Dplyr_Logo.png" style="width:80.0%"></div>
<p>In this section we will explore some of the most commonly used <code>dplyr</code> functions for exploring and transforming data frames. The input to and the output from all these functions are dataframes. These include</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> to select variables in a dataframe</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> to change the title of a variable</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> to select a number of observations that meet certain criteria</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> to reorder the observations</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to generate new variables or amend the existing ones</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> to divide the observations in groups</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> to generate new variables containing information about groups of observations</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> to count the number of observations with a given value</li>
</ol>
<p>In order to access these and other functions that used in this section, you need to load <code>dplyr</code> at the beginning of the session. This can also be done by loading the <code>tidyverse</code></p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#load tidyverse</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="co">#Alternatively load dplyr</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></code></pre></div>
<p>In this section we will explore the use of these data manipulation toolsthe <code>gapminder</code> dataset. If starting from a new Rstudio session you should run the following code to load the <code>gapminder</code> data in your environment.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#load gapminder</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="the-pipe-operator" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> The pipe (%&gt;%) operator<a class="anchor" aria-label="anchor" href="#the-pipe-operator"><i class="fas fa-link"></i></a>
</h2>
<p>Similarly to other functions included in R, dplyr functions can be launched by calling the name of the functions followed by a series of arguments specifying the input. In the case of most functions that are part of the <code>dplyr</code> package this takes the form of:</p>
<ul>
<li>call the function (e.g. <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>),</li>
<li>within parentheses, first specify the name of the dataset we would like to manipulate (e.g. <code>gapminder</code>)</li>
<li>and then list the input of the function (e.g. name of the columns to be selected)</li>
</ul>
<p>As we will see more in detail in the examples below, it is possible to call the different dplyr functions using a different syntax that takes advantage of the <em>pipe</em> (<code>%&gt;%</code>) operator to create code that is easier to write and to understand.</p>
<p>This syntax looks like this:</p>
<ul>
<li>call the name of the dataset to be manipulated</li>
<li>add the <code>%&gt;%</code> operator (read ‘<em>and then</em>’). This will pass the value of the data to the next step</li>
<li>call the function we want to use to manipulate our data</li>
</ul>
<p>For instance the two lines of code below are equivalent ways to display the top lines in the gapminder dataset:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span>

<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">head</span></code></pre></div>
<p>Both lines of code will return the same information:</p>
<pre><code>#&gt; # A tibble: 6 × 6
#&gt;   country     continent  year lifeExp      pop gdpPercap
#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
#&gt; 1 Afghanistan Asia       1952    28.8  8425333      779.
#&gt; 2 Afghanistan Asia       1957    30.3  9240934      821.
#&gt; 3 Afghanistan Asia       1962    32.0 10267083      853.
#&gt; 4 Afghanistan Asia       1967    34.0 11537966      836.
#&gt; 5 Afghanistan Asia       1972    36.1 13079460      740.
#&gt; 6 Afghanistan Asia       1977    38.4 14880372      786.</code></pre>
<p>This syntax facilitate the chaining of different steps in our analysis. If we are to perform another transformation to the same data, we can add the <code>%&gt;%</code> operator (read ‘<em>and then</em>’) to pass this data to a next operation. This avoids the need to save the data from each step to a new or existing data frame.</p>
</div>
<div id="selecting-variables" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Selecting Variables<a class="anchor" aria-label="anchor" href="#selecting-variables"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-figure"><img src="images/Select_Dplyr.png" style="width:80.0%"></div>
<p>While many real-world datasets include a large number of variables (columns), sometimes we need to include only a subset of these in our analysis.
The <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> function can be used to select variables in a data frame based on their name.
In order to call the subset the variables we need to:</p>
<ul>
<li>call the function <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>,</li>
<li>within parentheses, first specify the name of the dataset</li>
<li>and then list the name variables (without quotation marks and separated by a comma) we would like to retain in the order in which they should appear</li>
</ul>
<div class="inline-figure"><img src="images/dplyr-select1.png" style="width:80.0%"></div>
<p>In the example below we first load the <code>gapminder</code> dataset and then select the <code>year</code>, <code>country</code>, and <code>gdpPercap</code> variables. This narrower dataset is then stored in a different object.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="co"># Load gapmidner data</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op">)</span>

<span class="co">#Select three variables and place them in a new object </span>
<span class="va">gap_narrow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span>

<span class="co">#print the first rows of the gap_narrow dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gap_narrow</span> <span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 3</span>
<span class="co">#&gt;    year country     gdpPercap</span>
<span class="co">#&gt;   &lt;int&gt; &lt;fct&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1  1952 Afghanistan      779.</span>
<span class="co">#&gt; 2  1957 Afghanistan      821.</span>
<span class="co">#&gt; 3  1962 Afghanistan      853.</span>
<span class="co">#&gt; 4  1967 Afghanistan      836.</span>
<span class="co">#&gt; 5  1972 Afghanistan      740.</span>
<span class="co">#&gt; 6  1977 Afghanistan      786.</span></code></pre></div>
<p>Alternatively it is possible to insert this function in a chain of transformation using the pipe symbol <code>%&gt;%</code>. This includes the following steps:</p>
<ul>
<li>summon the dataframe</li>
<li>pass it on to the next step using the pipe symbol <code>%&gt;%</code>
</li>
<li>use the <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> function to choose which variables we want, listing these within parentheses.</li>
</ul>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Alternative approach with %&gt;% to select three variables and place them in a new object </span>
<span class="va">gap_narrow</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
gdpPercap
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1952
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
779.4453
</td>
</tr>
<tr>
<td style="text-align:right;">
1957
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
820.8530
</td>
</tr>
<tr>
<td style="text-align:right;">
1962
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
853.1007
</td>
</tr>
<tr>
<td style="text-align:right;">
1967
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
836.1971
</td>
</tr>
<tr>
<td style="text-align:right;">
1972
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
739.9811
</td>
</tr>
<tr>
<td style="text-align:right;">
1977
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
786.1134
</td>
</tr>
</tbody>
</table></div>
<div id="removing-variables" class="section level3" number="6.3.1">
<h3>
<span class="header-section-number">6.3.1</span> Removing variables<a class="anchor" aria-label="anchor" href="#removing-variables"><i class="fas fa-link"></i></a>
</h3>
<p>Instead of specifying the variables that we want to retain, we can also use the <code>select</code> function to specify which variables we would like to drop. In order to do this, we need to add a minus (<code>-</code>) sign in front of the name of the variable we would like to remove.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gap_narrow</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">gdpPercap</span>, <span class="op">-</span><span class="va">pop</span><span class="op">)</span></code></pre></div>
<p>The code below has removed the variable <code>gdpPercap</code> and <code>pop</code> from the gapminder dataset, while retaining the existing variables in their order</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
lifeExp
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
28.801
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
1957
</td>
<td style="text-align:right;">
30.332
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
1962
</td>
<td style="text-align:right;">
31.997
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
1967
</td>
<td style="text-align:right;">
34.020
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
36.088
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
1977
</td>
<td style="text-align:right;">
38.438
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="selecting-a-range-of-variables" class="section level3" number="6.3.2">
<h3>
<span class="header-section-number">6.3.2</span> Selecting a Range of Variables<a class="anchor" aria-label="anchor" href="#selecting-a-range-of-variables"><i class="fas fa-link"></i></a>
</h3>
<p>In the case we want to retain a range of variable, it is possible to list the first and last variable we want to retain from the existing dataset, separated by <code>:</code>.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gap_narrow</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span><span class="op">:</span><span class="va">gdpPercap</span><span class="op">)</span></code></pre></div>
</div>
<div id="selection-helpers" class="section level3" number="6.3.3">
<h3>
<span class="header-section-number">6.3.3</span> Selection Helpers<a class="anchor" aria-label="anchor" href="#selection-helpers"><i class="fas fa-link"></i></a>
</h3>
<p>It is possible to use <strong>selection helpers</strong> to select all variables whose name includes certain characters. Examples of functions that can be called inside <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> include:</p>
<ul>
<li>
<a href="https://tidyselect.r-lib.org/reference/starts_with.html"><code>starts_with()</code></a>: select all variables whose name starts with a prefix.</li>
<li>
<a href="https://tidyselect.r-lib.org/reference/starts_with.html"><code>ends_with()</code></a>: select all variables whose name ends with a suffix.</li>
<li>
<a href="https://tidyselect.r-lib.org/reference/starts_with.html"><code>contains()</code></a>: select all variables whose name contains a literal string.</li>
<li>
<a href="https://tidyselect.r-lib.org/reference/starts_with.html"><code>matches()</code></a>: Matches a regular expression.</li>
</ul>
<p>For instance, in this example we take a pre-loaded dataset named <code>iris</code> and select those variable whose name starts with “Petal” and ends with “Width”</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_iris</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Species</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Petal"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"Width"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">new_iris</span><span class="op">)</span>
<span class="co">#&gt;   Species Petal.Width</span>
<span class="co">#&gt; 1  setosa         0.2</span>
<span class="co">#&gt; 2  setosa         0.2</span>
<span class="co">#&gt; 3  setosa         0.2</span>
<span class="co">#&gt; 4  setosa         0.2</span>
<span class="co">#&gt; 5  setosa         0.2</span>
<span class="co">#&gt; 6  setosa         0.4</span></code></pre></div>
</div>
</div>
<div id="rename-variables" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Rename Variables<a class="anchor" aria-label="anchor" href="#rename-variables"><i class="fas fa-link"></i></a>
</h2>
<p>It is often the case that the name of the variables in a dataset are not clearly informative of the content of the variable.
We can change the name of columns in our dataset with the <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> function. This function takes the syntax <code>"new_name" = "old_name"</code> within parentheses.
When using this function, column names are changed but rows and the column order are not affected.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#load gapminder data</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op">)</span>

<span class="va">gap_renamed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span> <span class="va">gapminder</span>, <span class="st">"population"</span> <span class="op">=</span> <span class="st">"pop"</span><span class="op">)</span>

<span class="co">#List the name of the columns</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">gap_renamed</span><span class="op">)</span> 
<span class="co">#&gt; [1] "country"    "continent"  "year"       "lifeExp"   </span>
<span class="co">#&gt; [5] "population" "gdpPercap"</span></code></pre></div>
<p>Similarly to other functions that are part of dplyr, it is possible to use the pipe <code>%&gt;%</code> operator to chain the function.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gap_renamed</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"population"</span> <span class="op">=</span> <span class="va">pop</span><span class="op">)</span>

<span class="co">#Print the name of the variables</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">gap_renamed</span><span class="op">)</span>
<span class="co">#&gt; [1] "country"    "continent"  "year"       "lifeExp"   </span>
<span class="co">#&gt; [5] "population" "gdpPercap"</span></code></pre></div>
</div>
<div id="subset-observations-with-filter" class="section level2" number="6.5">
<h2>
<span class="header-section-number">6.5</span> Subset Observations with Filter()<a class="anchor" aria-label="anchor" href="#subset-observations-with-filter"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-figure"><img src="images/Filter_Dplyr.png"></div>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function is used to subset a data frame, retaining all rows where the condition expressed within the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> is true.</p>
<p>For instance, it is possible to retain only those observations (row) where a variable takes a certain value.</p>
<p>In the example below we want to retain only those observations from the gapminder dataset that pertain to Argentina. In order to do so, we filter those rows where the variable <code>country</code> is equal to (<code>==</code>) the string <code>Argentina</code></p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder_argentina</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Argentina"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span> <span class="op">(</span><span class="va">gapminder_argentina</span><span class="op">)</span>  
<span class="co">#&gt; # A tibble: 6 × 6</span>
<span class="co">#&gt;   country   continent  year lifeExp      pop gdpPercap</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Argentina Americas   1952    62.5 17876956     5911.</span>
<span class="co">#&gt; 2 Argentina Americas   1957    64.4 19610538     6857.</span>
<span class="co">#&gt; 3 Argentina Americas   1962    65.1 21283783     7133.</span>
<span class="co">#&gt; 4 Argentina Americas   1967    65.6 22934225     8053.</span>
<span class="co">#&gt; 5 Argentina Americas   1972    67.1 24779799     9443.</span>
<span class="co">#&gt; 6 Argentina Americas   1977    68.5 26983828    10079.</span></code></pre></div>
<div id="logical-operations" class="section level3" number="6.5.1">
<h3>
<span class="header-section-number">6.5.1</span> Logical operations<a class="anchor" aria-label="anchor" href="#logical-operations"><i class="fas fa-link"></i></a>
</h3>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> functions can also be used to filter rows that match multiple conditions. The rows that will be returned in this case depends on the logical operator that connects these conditions.</p>
<div id="and" class="section level4" number="6.5.1.1">
<h4>
<span class="header-section-number">6.5.1.1</span> &amp; (and)<a class="anchor" aria-label="anchor" href="#and"><i class="fas fa-link"></i></a>
</h4>
<p>The boolean operator <code>&amp;</code> (<code>*and*</code>) can be used to retain those rows that meet multiple conditions</p>
<p>When multiple expressions are listed within parentheses separated by a comma, the function will only retain those rows where all the criteria are met.</p>
<p>In this example we filter those observations that pertains to African countries after the year 1982. In the first example, the two conditions are separated by the <code>&amp;</code> operator within the same <code>filter</code> function, in the second example by a comma, and in the third example by calling different filters in sequential order.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder_africa</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Africa"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&gt;</span> <span class="fl">1982</span><span class="op">)</span> 

<span class="co">#Alternative formulation</span>
<span class="va">gapminder_africa</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Africa"</span>,
         <span class="va">year</span> <span class="op">&gt;</span> <span class="fl">1982</span><span class="op">)</span>  


<span class="co">#Alternative formulation</span>
<span class="va">gapminder_africa</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Africa"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">1982</span><span class="op">)</span> 

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gapminder_africa</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 6</span>
<span class="co">#&gt;   country continent  year lifeExp      pop gdpPercap</span>
<span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Algeria Africa     1987    65.8 23254956     5681.</span>
<span class="co">#&gt; 2 Algeria Africa     1992    67.7 26298373     5023.</span>
<span class="co">#&gt; 3 Algeria Africa     1997    69.2 29072015     4797.</span>
<span class="co">#&gt; 4 Algeria Africa     2002    71.0 31287142     5288.</span>
<span class="co">#&gt; 5 Algeria Africa     2007    72.3 33333216     6223.</span>
<span class="co">#&gt; 6 Angola  Africa     1987    39.9  7874230     2430.</span></code></pre></div>
</div>
<div id="or" class="section level4" number="6.5.1.2">
<h4>
<span class="header-section-number">6.5.1.2</span> | (or)<a class="anchor" aria-label="anchor" href="#or"><i class="fas fa-link"></i></a>
</h4>
<p>While the boolean operator <code>&amp;</code> can be used to retain those rows that meet multiple conditions, the boolean operator <code>or (</code>|`) can be used to retain the rows that meet any of multiple conditions.</p>
<p>For instance, in this example we can filter all the rows where the variable <code>continent</code> takes the value “Africa” or “Asia”.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder_africa_asia</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Africa"</span> <span class="op">|</span> <span class="va">continent</span> <span class="op">==</span> <span class="st">"Asia"</span><span class="op">)</span>  </code></pre></div>
</div>
</div>
<div id="not" class="section level3" number="6.5.2">
<h3>
<span class="header-section-number">6.5.2</span> ! (<em>not</em>)<a class="anchor" aria-label="anchor" href="#not"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>!</code> operator can be used to check if a condition is “not” present. For instance, we can use <code>!=</code> to filter observations that are different from a given value.</p>
<p>In this example we exclude from the analysis all the rows where the variable <code>continent</code> takes the value “Oceania”.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder_notOceania</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">!=</span> <span class="st">"Oceania"</span><span class="op">)</span>  </code></pre></div>
</div>
<div id="in-helper" class="section level3" number="6.5.3">
<h3>
<span class="header-section-number">6.5.3</span> %in% helper<a class="anchor" aria-label="anchor" href="#in-helper"><i class="fas fa-link"></i></a>
</h3>
<p>When we are interested in a subset of rows that can contain several different values, instead of writing a long OR command, its useful to just give a vector of values of interest.
In this case, the <code>%in%</code> operator can be called to retain all the rows where the value includes one of multiple values using</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder_africa_asia</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Africa"</span>,<span class="st">"Asia"</span><span class="op">)</span> <span class="op">)</span> </code></pre></div>
</div>
<div id="filter-using-comparison-operators" class="section level3" number="6.5.4">
<h3>
<span class="header-section-number">6.5.4</span> Filter using Comparison operators<a class="anchor" aria-label="anchor" href="#filter-using-comparison-operators"><i class="fas fa-link"></i></a>
</h3>
<p>Observations can be filtered using <a href="https://rdrr.io/r/base/Comparison.html">comparison operators</a> such as
- <code>==</code> (equal to)
- <code>&gt;</code> (greater than)
- <code>&gt;=</code> (greater or equal to)
- <code>&lt;</code> (smaller than), etc…</p>
<p>For instance, in the example below we want to retain all the observations after the year 1982.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder_recent</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">1982</span><span class="op">)</span> </code></pre></div>
</div>
</div>
<div id="create-and-modify-variables" class="section level2" number="6.6">
<h2>
<span class="header-section-number">6.6</span> Create and modify variables<a class="anchor" aria-label="anchor" href="#create-and-modify-variables"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-figure"><img src="images/Mutate_Dplyr.png" style="width:80.0%"></div>
<p>The function <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> can be used to add new variables, while preserving existing ones, or to overwrite existing variables with the same name. When we use this variable, the number of rows will not be affected</p>
<p>We can perform operations using the data in the existing columns. For instance, in the example below we first create a new variable called <code>gdp</code> by multiplying the values for each observations of two existing variables (gdp per capita and population). Here the newly created column will contain the results of a mathematical operation, performed row by row.</p>
<p>The transformations can also involve data that is not found in the columns. For instance, in teh example below we create a new variable called <code>gdp_billions</code> where we transforme the scale of the <code>gdp</code> variables by dividing the value by one billion (10^9)</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gap_gdp</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gdp <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">*</span><span class="va">pop</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gdp_billions <span class="op">=</span> <span class="va">gdp</span><span class="op">/</span><span class="fl">10</span><span class="op">^</span><span class="fl">9</span><span class="op">)</span> 

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gap_gdp</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 8</span>
<span class="co">#&gt;   country   continent  year lifeExp    pop gdpPercap     gdp</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;  &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Afghanis… Asia       1952    28.8 8.43e6      779. 6.57e 9</span>
<span class="co">#&gt; 2 Afghanis… Asia       1957    30.3 9.24e6      821. 7.59e 9</span>
<span class="co">#&gt; 3 Afghanis… Asia       1962    32.0 1.03e7      853. 8.76e 9</span>
<span class="co">#&gt; 4 Afghanis… Asia       1967    34.0 1.15e7      836. 9.65e 9</span>
<span class="co">#&gt; 5 Afghanis… Asia       1972    36.1 1.31e7      740. 9.68e 9</span>
<span class="co">#&gt; 6 Afghanis… Asia       1977    38.4 1.49e7      786. 1.17e10</span>
<span class="co">#&gt; # … with 1 more variable: gdp_billions &lt;dbl&gt;</span></code></pre></div>
<div id="logical-filtering-with-ifelse" class="section level3" number="6.6.1">
<h3>
<span class="header-section-number">6.6.1</span> Logical filtering with ifelse()<a class="anchor" aria-label="anchor" href="#logical-filtering-with-ifelse"><i class="fas fa-link"></i></a>
</h3>
<p>While the examples below illustrate how <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> can be used to perform the same transformations to all the rows of the same dataset, in some cases we would like to return a different transformation based on certain conditions. The creation of new variable or the manipulation of existing variables can be associated with a logical test.</p>
<p>An easy way to do this is to combine the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> function with the <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> statement.
<code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> is a function that tests each value in a column of data for a particular condition (a logical test), and returns one answer when the condition==TRUE, and another when the condition==FALSE.</p>
<p><code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> statements takes three commands <code>ifelse(test_expression, x, y)</code>, where:</p>
<ul>
<li>
<code>test_expression</code> is a statement that returns a true or false (logic) outcome (e.g. <code>continent == "Africa"</code>, <code>gdpPercap&gt; 1000</code>)</li>
<li>
<code>x</code> is the value returned if <code>test_expression</code> is <code>TRUE</code>
</li>
<li>
<code>y</code> is the value returned it <code>test_expression</code> is <code>FALSE</code>.</li>
</ul>
<p>For instance, below we create a new variable called <code>development</code> which takes the value <code>developed country</code> if the GDP per capita is above $25,000, and the value <code>developing country</code> if the GDP per capita is below or equal to the same threshold. Remember that we need two closing brackets, one for the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> function, and one for the <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> inside it.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gap_dev</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>development <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">&gt;</span> <span class="fl">25000</span>, 
                                <span class="st">"developed country"</span>, 
                                <span class="st">"developing country"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">gdpPercap</span>, <span class="va">development</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gap_dev</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 3</span>
<span class="co">#&gt;   country     gdpPercap development       </span>
<span class="co">#&gt;   &lt;fct&gt;           &lt;dbl&gt; &lt;chr&gt;             </span>
<span class="co">#&gt; 1 Afghanistan      779. developing country</span>
<span class="co">#&gt; 2 Afghanistan      821. developing country</span>
<span class="co">#&gt; 3 Afghanistan      853. developing country</span>
<span class="co">#&gt; 4 Afghanistan      836. developing country</span>
<span class="co">#&gt; 5 Afghanistan      740. developing country</span>
<span class="co">#&gt; 6 Afghanistan      786. developing country</span></code></pre></div>
</div>
<div id="logical-filtering-with-case_when" class="section level3" number="6.6.2">
<h3>
<span class="header-section-number">6.6.2</span> Logical filtering with case_when()<a class="anchor" aria-label="anchor" href="#logical-filtering-with-case_when"><i class="fas fa-link"></i></a>
</h3>
<p>At times we want to create a label column that tests multiple conditions. One option is to put multiple ifelse() commands inside each other (<code>ifelse(test1, valueiftest3true, ifelse(test2, valueiftest2true, ifelse(test 3, valueiftest3true)))</code>). This however would be difficult to read.</p>
<p>An alternative option is to use the function <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code>.</p>
<p>This command takes multiple conditions and tests them in order.
case_when() takes a conditional command in the same format as the first command in ifelse(), however only the action for the TRUE condition is given, separated with a tilde ~.
The catch-all command for rows that do not satisfy any other conditions, is given at the end.</p>
<p>Let’s use case_when() to make a label for the level of development of countries, distinguishing between low-income countries, middle-income countries, and advanced economies, and assign observations in the gapminder dataset to these categories based on their level of GDP per capita.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gap_dev</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>development <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
      <span class="va">gdpPercap</span><span class="op">&lt;</span> <span class="fl">25000</span> <span class="op">~</span> <span class="st">"low-income country"</span>,
      <span class="va">gdpPercap</span><span class="op">&gt;=</span> <span class="fl">25000</span> <span class="op">&amp;</span> <span class="va">gdpPercap</span><span class="op">&lt;</span><span class="fl">50000</span>  <span class="op">~</span> <span class="st">"middle- income country"</span>, 
      <span class="va">gdpPercap</span><span class="op">&gt;=</span> <span class="fl">50000</span>  <span class="op">~</span> <span class="st">"advanced economy"</span>,
      <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">'other'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">gdpPercap</span>, <span class="va">development</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gap_dev</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 3</span>
<span class="co">#&gt;   country     gdpPercap development       </span>
<span class="co">#&gt;   &lt;fct&gt;           &lt;dbl&gt; &lt;chr&gt;             </span>
<span class="co">#&gt; 1 Afghanistan      779. low-income country</span>
<span class="co">#&gt; 2 Afghanistan      821. low-income country</span>
<span class="co">#&gt; 3 Afghanistan      853. low-income country</span>
<span class="co">#&gt; 4 Afghanistan      836. low-income country</span>
<span class="co">#&gt; 5 Afghanistan      740. low-income country</span>
<span class="co">#&gt; 6 Afghanistan      786. low-income country</span></code></pre></div>
<p>Because we have captured the possible numerical values of GDP per capita, we don’t expect the catch-all output, “other”, to be present in the new variable.</p>
</div>
</div>
<div id="summarise-across-groups" class="section level2" number="6.7">
<h2>
<span class="header-section-number">6.7</span> Summarise Across Groups<a class="anchor" aria-label="anchor" href="#summarise-across-groups"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-figure"><img src="images/Summarise_Dplyr.png" style="width:80.0%"></div>
<p>Often we need to aggregate the observations in our data in order to gain some insights into the differences across different groups.The function <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> allow us to group all the observations in our dataset that correspond to a particular value or set of values.</p>
<p>For instance, calling the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function for the <code>gapminder</code> dataset and specifying the <code>continent</code> variable will group all the observations where this variable takes the same value (e.g. all the observation for African countries, Asian countries, European countries, etc…)</p>
<p><img src="images/dplyr_groupby.png" style="width:80.0%"><a href="https://swcarpentry.github.io/r-novice-gapminder/13-dplyr/">source</a>
Once we have specified how our data should be grouped, we can use this in conjunction with the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> function. This variable allows us to create new variable(s) by applying transformations to variables in each of our groups (for example, for our continent-specific data frames).</p>
<p><img src="images/dplyr_Groupby_summarize.png" style="width:80.0%"><a href="https://swcarpentry.github.io/r-novice-gapminder/13-dplyr/">source</a></p>
<p>The output is a new data frame reduced in size, with one row per group:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gdp_by_continents</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span>

<span class="va">gdp_by_continents</span>
<span class="co">#&gt; # A tibble: 5 × 2</span>
<span class="co">#&gt;   continent mean_gdpPercap</span>
<span class="co">#&gt;   &lt;fct&gt;              &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Africa             2194.</span>
<span class="co">#&gt; 2 Americas           7136.</span>
<span class="co">#&gt; 3 Asia               7902.</span>
<span class="co">#&gt; 4 Europe            14469.</span>
<span class="co">#&gt; 5 Oceania           18622.</span></code></pre></div>
<div id="grouping-by-multiple-variables" class="section level3" number="6.7.1">
<h3>
<span class="header-section-number">6.7.1</span> Grouping by multiple variables<a class="anchor" aria-label="anchor" href="#grouping-by-multiple-variables"><i class="fas fa-link"></i></a>
</h3>
<p>The function <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> also to create sub-groups based on the variable of a particular variable, and to run subsequent functions on all sub-groups.</p>
<p>For instance, in the example below, instead of calculating the average value of all the observations that belongs to the same continent, we group the observations only by <code>continent</code> and by <code>year</code> before calculating the average <code>gdpPercap</code>. This transformation results into the creation of a dataset where the rows represents each unique combination of the values available for these variables (e.g. Africa in 1957, Asia in 1992).</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 60 × 3</span>
<span class="co">#&gt; # Groups:   continent [5]</span>
<span class="co">#&gt;    continent  year mean_gdpPercap</span>
<span class="co">#&gt;    &lt;fct&gt;     &lt;int&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Africa     1952          1253.</span>
<span class="co">#&gt;  2 Africa     1957          1385.</span>
<span class="co">#&gt;  3 Africa     1962          1598.</span>
<span class="co">#&gt;  4 Africa     1967          2050.</span>
<span class="co">#&gt;  5 Africa     1972          2340.</span>
<span class="co">#&gt;  6 Africa     1977          2586.</span>
<span class="co">#&gt;  7 Africa     1982          2482.</span>
<span class="co">#&gt;  8 Africa     1987          2283.</span>
<span class="co">#&gt;  9 Africa     1992          2282.</span>
<span class="co">#&gt; 10 Africa     1997          2379.</span>
<span class="co">#&gt; # … with 50 more rows</span></code></pre></div>
</div>
<div id="summarizing-different-variables" class="section level3" number="6.7.2">
<h3>
<span class="header-section-number">6.7.2</span> Summarizing different variables<a class="anchor" aria-label="anchor" href="#summarizing-different-variables"><i class="fas fa-link"></i></a>
</h3>
<p>When you use the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> function it is possible to define different new variables at the same time.</p>
<p>For instance, in this example, after we grouped together different observations with the same value for the <code>continent</code> variable, we can calculate the average, lowest, and highest life expectancy (<code>lifeExp</code> variable) among all the observations of that group.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_le <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>,
              min_le <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>,
              max_le <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> 
<span class="co">#&gt; # A tibble: 5 × 4</span>
<span class="co">#&gt;   continent mean_le min_le max_le</span>
<span class="co">#&gt;   &lt;fct&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Africa       48.9   23.6   76.4</span>
<span class="co">#&gt; 2 Americas     64.7   37.6   80.7</span>
<span class="co">#&gt; 3 Asia         60.1   28.8   82.6</span>
<span class="co">#&gt; 4 Europe       71.9   43.6   81.8</span>
<span class="co">#&gt; 5 Oceania      74.3   69.1   81.2</span></code></pre></div>
</div>
<div id="counting-the-number-of-observations-by-group" class="section level3" number="6.7.3">
<h3>
<span class="header-section-number">6.7.3</span> Counting the number of observations by group<a class="anchor" aria-label="anchor" href="#counting-the-number-of-observations-by-group"><i class="fas fa-link"></i></a>
</h3>
<p>A common operation when analysing a dataset involves counting the number of observations that belongs to each group. We can achieve this by first grouping our data, creating a new variable using <code>summarize</code> and specify within this function the <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code> function to get the number of observations that below to that group.
The <code>dplyr</code> packages also includes a <code><a href="https://dplyr.tidyverse.org/reference/count.html">tally()</a></code> function to count the observations within each group that could be used to replace <code>summarize(n())</code></p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>observation_num<span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 5 × 2</span>
<span class="co">#&gt;   continent observation_num</span>
<span class="co">#&gt;   &lt;fct&gt;               &lt;int&gt;</span>
<span class="co">#&gt; 1 Africa                624</span>
<span class="co">#&gt; 2 Americas              300</span>
<span class="co">#&gt; 3 Asia                  396</span>
<span class="co">#&gt; 4 Europe                360</span>
<span class="co">#&gt; 5 Oceania                24</span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">tally</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Alternatively we can achieve the same outcome by using the <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> function. count() is a shortcut function that combines group_by() and summarize(), which is useful for counting ‘character data’, e.g. labels. We can also optionally sort the results in descending order by adding <code>sort=TRUE</code>:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">continent</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="mutate-vs.-summarize" class="section level3" number="6.7.4">
<h3>
<span class="header-section-number">6.7.4</span> mutate() vs. summarize()<a class="anchor" aria-label="anchor" href="#mutate-vs.-summarize"><i class="fas fa-link"></i></a>
</h3>
<p>Both <code>mutate</code> or <code>summarize</code> can be used to create new variables in a data
It can be confusing to decide which one is appropriate.
The key distinction is whether you want the output to have one row for each group or one row for each row in the original data frame.</p>
<p>When applied with grouped data, <code>mutate</code> creates new columns with as many rows as the original data frame.To do this, group_by() can be combined with mutate(), to make a new column of summary statistics (repeated many times) corresponding to the sub-grouping of interest.</p>
<div class="inline-figure"><img src="images/Group_by_summarise.png"></div>
<p>When applied with grouped data, <code>summarize</code> creates a data frame with as many rows as groups. The output of summarize() is generally a smaller dataframe with a reduced representation of the input data.</p>
</div>
</div>
<div id="sorting-observations" class="section level2" number="6.8">
<h2>
<span class="header-section-number">6.8</span> Sorting observations<a class="anchor" aria-label="anchor" href="#sorting-observations"><i class="fas fa-link"></i></a>
</h2>
<p>We can use the <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> to sort the rows in our data frame according to values in a certain column.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1,704 × 6</span>
<span class="co">#&gt;    country     continent  year lifeExp      pop gdpPercap</span>
<span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Afghanistan Asia       1952    28.8  8425333      779.</span>
<span class="co">#&gt;  2 Albania     Europe     1952    55.2  1282697     1601.</span>
<span class="co">#&gt;  3 Algeria     Africa     1952    43.1  9279525     2449.</span>
<span class="co">#&gt;  4 Angola      Africa     1952    30.0  4232095     3521.</span>
<span class="co">#&gt;  5 Argentina   Americas   1952    62.5 17876956     5911.</span>
<span class="co">#&gt;  6 Australia   Oceania    1952    69.1  8691212    10040.</span>
<span class="co">#&gt;  7 Austria     Europe     1952    66.8  6927772     6137.</span>
<span class="co">#&gt;  8 Bahrain     Asia       1952    50.9   120447     9867.</span>
<span class="co">#&gt;  9 Bangladesh  Asia       1952    37.5 46886859      684.</span>
<span class="co">#&gt; 10 Belgium     Europe     1952    68    8730405     8343.</span>
<span class="co">#&gt; # … with 1,694 more rows</span></code></pre></div>
<div id="desc-helper-function" class="section level3" number="6.8.1">
<h3>
<span class="header-section-number">6.8.1</span> desc() helper function<a class="anchor" aria-label="anchor" href="#desc-helper-function"><i class="fas fa-link"></i></a>
</h3>
<p>When we call the <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> function, the default is to order numbers from lowest -&gt; highest.
To invert the standard order, we can use the ‘descending’ desc() helper function.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1,704 × 6</span>
<span class="co">#&gt;    country     continent  year lifeExp       pop gdpPercap</span>
<span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Afghanistan Asia       2007    43.8  31889923      975.</span>
<span class="co">#&gt;  2 Albania     Europe     2007    76.4   3600523     5937.</span>
<span class="co">#&gt;  3 Algeria     Africa     2007    72.3  33333216     6223.</span>
<span class="co">#&gt;  4 Angola      Africa     2007    42.7  12420476     4797.</span>
<span class="co">#&gt;  5 Argentina   Americas   2007    75.3  40301927    12779.</span>
<span class="co">#&gt;  6 Australia   Oceania    2007    81.2  20434176    34435.</span>
<span class="co">#&gt;  7 Austria     Europe     2007    79.8   8199783    36126.</span>
<span class="co">#&gt;  8 Bahrain     Asia       2007    75.6    708573    29796.</span>
<span class="co">#&gt;  9 Bangladesh  Asia       2007    64.1 150448339     1391.</span>
<span class="co">#&gt; 10 Belgium     Europe     2007    79.4  10392226    33693.</span>
<span class="co">#&gt; # … with 1,694 more rows</span></code></pre></div>
</div>
<div id="sorting-by-multiple-columns" class="section level3" number="6.8.2">
<h3>
<span class="header-section-number">6.8.2</span> Sorting by multiple columns<a class="anchor" aria-label="anchor" href="#sorting-by-multiple-columns"><i class="fas fa-link"></i></a>
</h3>
<p>It is possible to refine the order by giving additional columns of data.
In the example below we organize our rows first by <code>year</code> (recent first), and then by <code>continent</code>.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder_with_extra_vars</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,
              sd_gdpPercap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,
              mean_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,
              sd_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="va">continent</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gapminder_with_extra_vars</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 10</span>
<span class="co">#&gt; # Groups:   continent, year [1]</span>
<span class="co">#&gt;   country      continent  year lifeExp      pop gdpPercap</span>
<span class="co">#&gt;   &lt;fct&gt;        &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Algeria      Africa     2007    72.3 33333216     6223.</span>
<span class="co">#&gt; 2 Angola       Africa     2007    42.7 12420476     4797.</span>
<span class="co">#&gt; 3 Benin        Africa     2007    56.7  8078314     1441.</span>
<span class="co">#&gt; 4 Botswana     Africa     2007    50.7  1639131    12570.</span>
<span class="co">#&gt; 5 Burkina Faso Africa     2007    52.3 14326203     1217.</span>
<span class="co">#&gt; 6 Burundi      Africa     2007    49.6  8390505      430.</span>
<span class="co">#&gt; # … with 4 more variables: mean_gdpPercap &lt;dbl&gt;,</span>
<span class="co">#&gt; #   sd_gdpPercap &lt;dbl&gt;, mean_pop &lt;dbl&gt;, sd_pop &lt;dbl&gt;</span></code></pre></div>
</div>
</div>
<div id="chaining-different-transformations-with" class="section level2" number="6.9">
<h2>
<span class="header-section-number">6.9</span> Chaining different transformations with <code>%&gt;%</code><a class="anchor" aria-label="anchor" href="#chaining-different-transformations-with"><i class="fas fa-link"></i></a>
</h2>
<p>It is possible to link different data transformations using the pipe operator (<code>%&gt;%</code>). In this case the result of a command is passed to the next one.</p>
<p>Once we’re happy with the output of this chain of functions, we can assign it to a new object in the environment.</p>
<p>Here are some examples illustrating how these different tools to manipulate the dataset can be chained.</p>
<div id="example-ranking-european-countries-by-gdp" class="section level3" number="6.9.1">
<h3>
<span class="header-section-number">6.9.1</span> Example: Ranking European Countries by GDP<a class="anchor" aria-label="anchor" href="#example-ranking-european-countries-by-gdp"><i class="fas fa-link"></i></a>
</h3>
<p>For instance, the code below takes the gapminder dataset and manipulates this data in order to rank European countries by GDP in 2007</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#take the dataset gap</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span><span class="fl">2007</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>   <span class="co">#filter observations where year is equal to 2007</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Europe"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#filter observations where variable continent is "Europe"</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>GDP <span class="op">=</span> <span class="va">pop</span> <span class="op">*</span> <span class="va">gdpPercap</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#create a new variable "GDP" which multiplies pop * gdpPercap</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">GDP</span><span class="op">)</span><span class="op">)</span> <span class="co">#order the observations based on GDP</span>
<span class="co">#&gt; # A tibble: 30 × 7</span>
<span class="co">#&gt;    country  continent  year lifeExp    pop gdpPercap     GDP</span>
<span class="co">#&gt;    &lt;fct&gt;    &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;  &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Germany  Europe     2007    79.4 8.24e7    32170. 2.65e12</span>
<span class="co">#&gt;  2 United … Europe     2007    79.4 6.08e7    33203. 2.02e12</span>
<span class="co">#&gt;  3 France   Europe     2007    80.7 6.11e7    30470. 1.86e12</span>
<span class="co">#&gt;  4 Italy    Europe     2007    80.5 5.81e7    28570. 1.66e12</span>
<span class="co">#&gt;  5 Spain    Europe     2007    80.9 4.04e7    28821. 1.17e12</span>
<span class="co">#&gt;  6 Netherl… Europe     2007    79.8 1.66e7    36798. 6.10e11</span>
<span class="co">#&gt;  7 Turkey   Europe     2007    71.8 7.12e7     8458. 6.02e11</span>
<span class="co">#&gt;  8 Poland   Europe     2007    75.6 3.85e7    15390. 5.93e11</span>
<span class="co">#&gt;  9 Belgium  Europe     2007    79.4 1.04e7    33693. 3.50e11</span>
<span class="co">#&gt; 10 Sweden   Europe     2007    80.9 9.03e6    33860. 3.06e11</span>
<span class="co">#&gt; # … with 20 more rows</span></code></pre></div>
</div>
<div id="example-evolution-of-average-life-expectancy-in-africa-since-1960" class="section level3" number="6.9.2">
<h3>
<span class="header-section-number">6.9.2</span> Example: Evolution of Average Life Expectancy in Africa since 1960<a class="anchor" aria-label="anchor" href="#example-evolution-of-average-life-expectancy-in-africa-since-1960"><i class="fas fa-link"></i></a>
</h3>
<p>The code below takes the gapminder dataset and manipulates this data in order to calculate the evolution of the average life expectancy in Africa since 1960</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
        
<span class="co"># take the gapminder dataset (gap) and produce a dataset that includes the evolution in the average life expectancy in African countries since 1960</span>
<span class="co"># </span>
<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>       <span class="co">#take the dataset gapminder</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span><span class="fl">1960</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co">#filter observations where year is equal or higher than 1960</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># group the data across different combinations of year and continent</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Africa"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#filter observations where variable continent is "Africa"</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>Average_Life_Expectancy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="co">#create a variable Average_Life_Expectancy that captures the mean lifeExp in each continent in each year</span>
<span class="co">#&gt; # A tibble: 10 × 3</span>
<span class="co">#&gt; # Groups:   continent [1]</span>
<span class="co">#&gt;    continent  year Average_Life_Expectancy</span>
<span class="co">#&gt;    &lt;fct&gt;     &lt;int&gt;                   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Africa     1962                    43.3</span>
<span class="co">#&gt;  2 Africa     1967                    45.3</span>
<span class="co">#&gt;  3 Africa     1972                    47.5</span>
<span class="co">#&gt;  4 Africa     1977                    49.6</span>
<span class="co">#&gt;  5 Africa     1982                    51.6</span>
<span class="co">#&gt;  6 Africa     1987                    53.3</span>
<span class="co">#&gt;  7 Africa     1992                    53.6</span>
<span class="co">#&gt;  8 Africa     1997                    53.6</span>
<span class="co">#&gt;  9 Africa     2002                    53.3</span>
<span class="co">#&gt; 10 Africa     2007                    54.8</span></code></pre></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="inspecting-a-dataset.html"><span class="header-section-number">5</span> Inspecting a Dataset</a></div>
<div class="next"><a href="missing-values.html"><span class="header-section-number">7</span> Missing Values</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-transformation-with-dplyr"><span class="header-section-number">6</span> Data Transformation with dplyr()</a></li>
<li><a class="nav-link" href="#dplyr"><span class="header-section-number">6.1</span> Dplyr</a></li>
<li><a class="nav-link" href="#the-pipe-operator"><span class="header-section-number">6.2</span> The pipe (%&gt;%) operator</a></li>
<li>
<a class="nav-link" href="#selecting-variables"><span class="header-section-number">6.3</span> Selecting Variables</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#removing-variables"><span class="header-section-number">6.3.1</span> Removing variables</a></li>
<li><a class="nav-link" href="#selecting-a-range-of-variables"><span class="header-section-number">6.3.2</span> Selecting a Range of Variables</a></li>
<li><a class="nav-link" href="#selection-helpers"><span class="header-section-number">6.3.3</span> Selection Helpers</a></li>
</ul>
</li>
<li><a class="nav-link" href="#rename-variables"><span class="header-section-number">6.4</span> Rename Variables</a></li>
<li>
<a class="nav-link" href="#subset-observations-with-filter"><span class="header-section-number">6.5</span> Subset Observations with Filter()</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#logical-operations"><span class="header-section-number">6.5.1</span> Logical operations</a></li>
<li><a class="nav-link" href="#not"><span class="header-section-number">6.5.2</span> ! (not)</a></li>
<li><a class="nav-link" href="#in-helper"><span class="header-section-number">6.5.3</span> %in% helper</a></li>
<li><a class="nav-link" href="#filter-using-comparison-operators"><span class="header-section-number">6.5.4</span> Filter using Comparison operators</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#create-and-modify-variables"><span class="header-section-number">6.6</span> Create and modify variables</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#logical-filtering-with-ifelse"><span class="header-section-number">6.6.1</span> Logical filtering with ifelse()</a></li>
<li><a class="nav-link" href="#logical-filtering-with-case_when"><span class="header-section-number">6.6.2</span> Logical filtering with case_when()</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#summarise-across-groups"><span class="header-section-number">6.7</span> Summarise Across Groups</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#grouping-by-multiple-variables"><span class="header-section-number">6.7.1</span> Grouping by multiple variables</a></li>
<li><a class="nav-link" href="#summarizing-different-variables"><span class="header-section-number">6.7.2</span> Summarizing different variables</a></li>
<li><a class="nav-link" href="#counting-the-number-of-observations-by-group"><span class="header-section-number">6.7.3</span> Counting the number of observations by group</a></li>
<li><a class="nav-link" href="#mutate-vs.-summarize"><span class="header-section-number">6.7.4</span> mutate() vs. summarize()</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#sorting-observations"><span class="header-section-number">6.8</span> Sorting observations</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#desc-helper-function"><span class="header-section-number">6.8.1</span> desc() helper function</a></li>
<li><a class="nav-link" href="#sorting-by-multiple-columns"><span class="header-section-number">6.8.2</span> Sorting by multiple columns</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#chaining-different-transformations-with"><span class="header-section-number">6.9</span> Chaining different transformations with %&gt;%</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#example-ranking-european-countries-by-gdp"><span class="header-section-number">6.9.1</span> Example: Ranking European Countries by GDP</a></li>
<li><a class="nav-link" href="#example-evolution-of-average-life-expectancy-in-africa-since-1960"><span class="header-section-number">6.9.2</span> Example: Evolution of Average Life Expectancy in Africa since 1960</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>IP2038 - Analysing Political and Economic Data in the Real World - Course Material</strong>" was written by Stefano Pagliari. It was last built on 2022-02-11.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
