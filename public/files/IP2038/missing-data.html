<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 11 Missing Data | IP2038 - Analysing Political and Economic Data in the Real World - Course Material</title>
<meta name="author" content="Stefano Pagliari">
<meta name="description" content="Missing values are ubiquitous in data and need to be carefully explored and handled in the initial stages of analysis. Large datasets often have missing values for various reasons: coding errors,...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 11 Missing Data | IP2038 - Analysing Political and Economic Data in the Real World - Course Material">
<meta property="og:type" content="book">
<meta property="og:description" content="Missing values are ubiquitous in data and need to be carefully explored and handled in the initial stages of analysis. Large datasets often have missing values for various reasons: coding errors,...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 11 Missing Data | IP2038 - Analysing Political and Economic Data in the Real World - Course Material">
<meta name="twitter:description" content="Missing values are ubiquitous in data and need to be carefully explored and handled in the initial stages of analysis. Large datasets often have missing values for various reasons: coding errors,...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.10/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">IP2038 - Analysing Political and Economic Data in the Real World - Course Material</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction to the Module</a></li>
<li><a class="" href="rstudio-and-rstudio-cloud.html"><span class="header-section-number">2</span> RStudio and RStudio Cloud</a></li>
<li><a class="" href="getting-started-with-r.html"><span class="header-section-number">3</span> Getting Started with R</a></li>
<li><a class="" href="importing-data-into-r.html"><span class="header-section-number">4</span> Importing Data into R</a></li>
<li><a class="" href="inspecting-a-dataset.html"><span class="header-section-number">5</span> Inspecting a Dataset</a></li>
<li><a class="" href="data-visualization-with-ggplot.html"><span class="header-section-number">6</span> Data Visualization with ggplot</a></li>
<li><a class="" href="types-of-visualizations.html"><span class="header-section-number">7</span> Types of visualizations</a></li>
<li><a class="" href="data-wrangling-with-dplyr.html"><span class="header-section-number">8</span> Data Wrangling with dplyr</a></li>
<li><a class="" href="reshaping-the-data-with-tidyr.html"><span class="header-section-number">9</span> Reshaping the data with tidyr</a></li>
<li><a class="" href="relational-data.html"><span class="header-section-number">10</span> Relational Data</a></li>
<li><a class="active" href="missing-data.html"><span class="header-section-number">11</span> Missing Data</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="list-of-datasets.html"><span class="header-section-number">A</span> List of Datasets</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="missing-data" class="section level1" number="11">
<h1>
<span class="header-section-number">11</span> Missing Data<a class="anchor" aria-label="anchor" href="#missing-data"><i class="fas fa-link"></i></a>
</h1>
<p>Missing values are ubiquitous in data and need to be carefully explored and handled in the initial stages of analysis. Large datasets often have missing values for various reasons: coding errors, governments that hide information, data not collected yet, among others. In some cases, the source of the dataset will explain the source of missing values and how they were treated, while in others you will have to figure out yourself the extent to which the data contains missing value and how this may influence your analysis.</p>
<p>Whatever the case, we need to take this into account when doing our analysis.</p>
<p>R registers missing values as <code>NA</code> (not available). Note that this is not
a character value with the letters “N” and “A”, but a distinct type of
value.</p>
<div id="checking-for-missing-values" class="section level2" number="11.1">
<h2>
<span class="header-section-number">11.1</span> Checking for missing values<a class="anchor" aria-label="anchor" href="#checking-for-missing-values"><i class="fas fa-link"></i></a>
</h2>
<p>In R, we can control for the presence of missing values using the function <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code></p>
<p>For instance, in the code below we first create a sample vector that includes missing values and we then use the function <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> to control for the presence of missing data. This returns a vector of equal length, where each element takes value <code>true</code> if the corresponding element in the original vector was missing.</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Create vector including the monthly inflation rates in the US</span>
<span class="va">Inflation_Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">45</span>, <span class="fl">23</span>, <span class="cn">NA</span>, <span class="fl">21</span>, <span class="cn">NA</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Inflation_Data</span><span class="op">)</span>
<span class="co">#&gt; [1] FALSE FALSE  TRUE FALSE  TRUE</span></code></pre></div>
<p>We can calculate the number of missing values by summing up the elements of the vector where the <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> has returned a true value.</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Create vector including the monthly inflation rates in the US</span>
<span class="va">Inflation_Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">45</span>, <span class="fl">23</span>, <span class="cn">NA</span>, <span class="fl">21</span>, <span class="cn">NA</span><span class="op">)</span>

<span class="co">#Store in a vector a logic element recording whether the value was missing</span>
<span class="va">Missing_Inflation_Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Inflation_Data</span><span class="op">)</span>

<span class="co">#Sum the number of NA (TRUE value in "missing votes")</span>
<span class="va">SumNA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Missing_Inflation_Data</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"There are "</span>, <span class="va">SumNA</span>, <span class="st">" missing votes in our initial vector"</span> <span class="op">)</span>
<span class="co">#&gt; [1] "There are  2  missing votes in our initial vector"</span></code></pre></div>
<p>There are also other tools to look at missing data.</p>
<p>For instance the <code>naniar</code> package provides different tools to identify the presence of missing data in a dataset.</p>
<p>Once the package is loaded, the function <code><a href="https://rdrr.io/pkg/naniar/man/miss_var_summary.html">miss_var_summary()</a></code> then returns the number of missing values in a variable, and the percent missing in that variable.</p>
<p>Here is the number and percentage of missing values across different variables in the package “airquality”.</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#install.packages("naniar") #This needs to be run only the fist time</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/njtierney/naniar">naniar</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/naniar/man/miss_var_summary.html">miss_var_summary</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 3</span>
<span class="co">#&gt;   variable n_miss pct_miss</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Ozone        37    24.2 </span>
<span class="co">#&gt; 2 Solar.R       7     4.58</span>
<span class="co">#&gt; 3 Wind          0     0   </span>
<span class="co">#&gt; 4 Temp          0     0   </span>
<span class="co">#&gt; 5 Month         0     0   </span>
<span class="co">#&gt; 6 Day           0     0</span></code></pre></div>
<p>The <code>visdat</code> package instead provides a number of functions to provide a graphical overview of the presence of missing data in our dataset.</p>
<p>For instance, the <code>vis_miss</code> function in the <code>visdat</code> package can be called to illustrate whether the data is missing or not in each columns of a dataframe.</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#install.packages("visdat") #the package needs to be installed only the first time</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://visdat.njtierney.com/">visdat</a></span><span class="op">)</span>

<span class="fu"><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html">vis_miss</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span>
<span class="co">#&gt; Warning: `gather_()` was deprecated in tidyr 1.2.0.</span>
<span class="co">#&gt; Please use `gather()` instead.</span>
<span class="co">#&gt; This warning is displayed once every 8 hours.</span>
<span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</span></code></pre></div>
<div class="inline-figure"><img src="9_Missing_Data_files/figure-html/Vis_miss-1.png" width="672"></div>
<p>In the same package the <code><a href="https://rdrr.io/pkg/naniar/man/gg_miss_var.html">gg_miss_var()</a></code> function can be used to visualise the missing data across different variables</p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/naniar/man/gg_miss_var.html">gg_miss_var</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span>
<span class="co">#&gt; Warning: It is deprecated to specify `guide = FALSE` to</span>
<span class="co">#&gt; remove a guide. Please use `guide = "none"` instead.</span></code></pre></div>
<div class="inline-figure"><img src="9_Missing_Data_files/figure-html/ggmisvar-1.png" width="672"></div>
<p>There are more visualisations available in <code>naniar</code> (each starting with <code>gg_miss_</code>) - you can see these in the <a href="https://cran.r-project.org/package=naniar/vignettes/naniar-visualisation.html">“Gallery of Missing Data Visualisations” vignette.</a>.</p>
</div>
<div id="cleaning-missing-values" class="section level2" number="11.2">
<h2>
<span class="header-section-number">11.2</span> Cleaning missing values<a class="anchor" aria-label="anchor" href="#cleaning-missing-values"><i class="fas fa-link"></i></a>
</h2>
<p>Other datasets may have other ways of representing missing values, such as “99”, or “Missing”, or “Unknown”, or empty character value “” which looks “blank”, or a single space ” “.</p>
<p>It is possible to clean the missing values espressed in a dataset with characters (e.g. “99”, “Missing”) by converging them to <code>NA</code>.
The <code><a href="https://dplyr.tidyverse.org/reference/na_if.html">na_if()</a></code> function from the <code>dplyr</code> package (part of the <code>tidyverse</code>) will replace the specified value with <code>NA</code>.</p>
<p>For instance, this vector includes a sequence of numbers capturing the level of GDP growth in a country. A glimpse at the values show that there is a significant discrepancy between most of the values reported and the value 99, which suggests this could be a missing number. If we are able to ascertain that this is the case, we can replace it with NA using the <code><a href="https://dplyr.tidyverse.org/reference/na_if.html">na_if()</a></code></p>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'tidyr' was built under R version 4.0.5</span>
<span class="co">#&gt; Warning: package 'readr' was built under R version 4.0.5</span>
<span class="va">GDP_Growth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.2</span>, <span class="fl">2.2</span>, <span class="fl">99</span>, <span class="fl">3.2</span>, <span class="fl">1.7</span>, <span class="fl">1.2</span>, <span class="fl">1.0</span>, <span class="fl">99</span><span class="op">)</span>

<span class="va">GDP_Growth_Clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/na_if.html">na_if</a></span><span class="op">(</span><span class="va">GDP_Growth</span>, <span class="fl">99</span><span class="op">)</span>

<span class="va">GDP_Growth_Clean</span>
<span class="co">#&gt; [1] 3.2 2.2  NA 3.2 1.7 1.2 1.0  NA</span></code></pre></div>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">London_Borough</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sutton"</span>, <span class="st">"Missing"</span>, <span class="st">"Croydon"</span>, <span class="st">"Bromley"</span>, <span class="st">"Lewisham"</span>, <span class="st">"Greenwich"</span>, <span class="st">"Bexley"</span>, <span class="st">"Havering"</span>, <span class="st">"Barking and Dagenham"</span><span class="op">)</span>

<span class="va">London_Borough_Clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/na_if.html">na_if</a></span><span class="op">(</span><span class="va">GDP_Growth</span>, <span class="st">"Missing"</span><span class="op">)</span>

<span class="va">London_Borough_Clean</span>
<span class="co">#&gt; [1]  3.2  2.2 99.0  3.2  1.7  1.2  1.0 99.0</span></code></pre></div>
<p>In other cases, instead of replacing a missing value with <code>NA</code> we may want to replace with another value.
The function <code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code> replaces a given value in a dataset, variable, or a vector with <code>NA</code>.</p>
<p>For instance, let’s imagine that we have collected data on the number of hours spent by each day consuming news on the internet in a week, and have missing values in those days when we did not consume any. In this case, we may want to replace the <code>NA</code> value with 0</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TV_Hours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span>

<span class="va">GDP_Growth_Clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">TV_Hours</span>, <span class="fl">0</span><span class="op">)</span></code></pre></div>
</div>
<div id="operations-with-missing-values" class="section level2" number="11.3">
<h2>
<span class="header-section-number">11.3</span> Operations with Missing Values<a class="anchor" aria-label="anchor" href="#operations-with-missing-values"><i class="fas fa-link"></i></a>
</h2>
<p>By default, most R operations performed with missing values fail , alerting you that they cannot compute what you need. For instance, When you run a mathematical function such as <a href="https://rdrr.io/r/base/Extremes.html"><code>max()</code></a>, <a href="https://rdrr.io/r/base/Extremes.html"><code>min()</code></a>, <a href="https://rdrr.io/r/base/sum.html"><code>sum()</code></a> or <a href="https://rdrr.io/r/base/mean.html"><code>mean()</code></a>, if there are any <code>NA</code> values present the returned value will be <code>NA</code>.</p>
<p>For instance, see what happens when we try to calculate the average number of a vector that includes missing values</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Create vector including the monthly inflation rates in the US</span>
<span class="va">Votes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">45</span>, <span class="fl">23</span>, <span class="cn">NA</span>, <span class="fl">21</span>, <span class="cn">NA</span><span class="op">)</span>

<span class="co">#Calculate the Mean value, excluding the NA. </span>
<span class="va">Mean_Results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Votes</span><span class="op">)</span>

<span class="co">#Display the results in the console</span>
<span class="va">Mean_Results</span> 
<span class="co">#&gt; [1] NA</span></code></pre></div>
<p>You can avoid this problem by removing missing values from the calculation. In most functions, you can specify this with the argument <code>na.rm = TRUE</code> to let R know that it should ignore the missing values in the
vector to carry out the function.</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Create vector including NA value</span>
<span class="va">Votes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">45</span>, <span class="fl">23</span>, <span class="cn">NA</span>, <span class="fl">21</span>, <span class="cn">NA</span><span class="op">)</span>

<span class="co">#Calculate the Mean value, excluding the NA</span>
<span class="va">Mean_Results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Votes</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
 
<span class="co">#Display the results in the console</span>
<span class="va">Mean_Results</span> 
<span class="co">#&gt; [1] 29.66667</span></code></pre></div>
</div>
<div id="dropping-missing-values" class="section level2" number="11.4">
<h2>
<span class="header-section-number">11.4</span> Dropping Missing Values<a class="anchor" aria-label="anchor" href="#dropping-missing-values"><i class="fas fa-link"></i></a>
</h2>
<p>In some cases it may be appropriate to remove those observations where data is not available in one or more of the variables we are interested in exploring.</p>
<p>The <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></code> function is part of the <code>dplyr</code> package (included in the <code>tidyverse</code> library). If run with the parentheses empty, the function can be used to filter a dataset and retain only the rows without missing values.</p>
<p>If instead column names are specified within the parentheses, rows with missing values in those columns will be dropped.</p>
</div>
<div id="completing-missing-values" class="section level2" number="11.5">
<h2>
<span class="header-section-number">11.5</span> Completing Missing Values<a class="anchor" aria-label="anchor" href="#completing-missing-values"><i class="fas fa-link"></i></a>
</h2>
<p>While in some cases missing values are explicitly flagged with <code>NA</code> or some other value, in some cases a value is simply not present in the data.</p>
<p>An illustration can be found in the table below (from Wickham and Grolemund).</p>
<pre><code>#&gt; # A tibble: 7 × 3
#&gt;    year   qtr return
#&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1  2015     1   1.88
#&gt; 2  2015     2   0.59
#&gt; 3  2015     3   0.35
#&gt; 4  2015     4  NA   
#&gt; 5  2016     2   0.92
#&gt; 6  2016     3   0.17
#&gt; 7  2016     4   2.66</code></pre>
<p>The table provides the return of the stock market (column <code>return</code>) in different quarters (column <code>qtr</code>) of each year (column <code>year</code>).</p>
<p>A closer look reveals that the return for the first quarter of 2016 does not appear in the dataset.</p>
<p>It is often appropriate to make this implicit missing value explicit. One tool available in the <code>tidyr</code> package (part of the tidyverse) is the <code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code> function.</p>
<p>This function takes a set of columns, and finds all unique combinations. It then ensures the original dataset contains all those values, filling in explicit NAs where necessary.</p>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stocks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">qtr</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 8 × 3</span>
<span class="co">#&gt;    year   qtr return</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1  2015     1   1.88</span>
<span class="co">#&gt; 2  2015     2   0.59</span>
<span class="co">#&gt; 3  2015     3   0.35</span>
<span class="co">#&gt; 4  2015     4  NA   </span>
<span class="co">#&gt; 5  2016     1  NA   </span>
<span class="co">#&gt; 6  2016     2   0.92</span>
<span class="co">#&gt; 7  2016     3   0.17</span>
<span class="co">#&gt; 8  2016     4   2.66</span></code></pre></div>
</div>
<div id="filling-missing-values" class="section level2" number="11.6">
<h2>
<span class="header-section-number">11.6</span> Filling Missing Values<a class="anchor" aria-label="anchor" href="#filling-missing-values"><i class="fas fa-link"></i></a>
</h2>
<p>In some real world dataset, missing values indicate that the the previous value should be carried forward.</p>
<p>Take for instance the dataset below. This data includes quarterly data for the stock market return across different years. The value of the year is however filled only in the first quarter of each year.</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  year   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">2016</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,
  qtr    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>   <span class="fl">1</span>,    <span class="fl">2</span>,    <span class="fl">3</span>,    <span class="fl">4</span>, <span class="fl">1</span>,   <span class="fl">2</span>,    <span class="fl">3</span>,    <span class="fl">4</span><span class="op">)</span>,
  return <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.88</span>, <span class="fl">0.59</span>, <span class="fl">0.35</span>,  <span class="fl">0.9</span>, <span class="fl">1.1</span>, <span class="fl">0.92</span>, <span class="fl">0.17</span>, <span class="fl">2.66</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">stocks</span>
<span class="co">#&gt; # A tibble: 8 × 3</span>
<span class="co">#&gt;    year   qtr return</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1  2015     1   1.88</span>
<span class="co">#&gt; 2    NA     2   0.59</span>
<span class="co">#&gt; 3    NA     3   0.35</span>
<span class="co">#&gt; 4    NA     4   0.9 </span>
<span class="co">#&gt; 5  2016     1   1.1 </span>
<span class="co">#&gt; 6    NA     2   0.92</span>
<span class="co">#&gt; 7    NA     3   0.17</span>
<span class="co">#&gt; 8    NA     4   2.66</span></code></pre></div>
<p>You can fill in these missing values with <code><a href="https://ggplot2.tidyverse.org/reference/aes_colour_fill_alpha.html">fill()</a></code> from the <code>tidyr</code> package. It takes a set of columns where you want missing values to be replaced by the last observation found.</p>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stocks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_colour_fill_alpha.html">fill</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 8 × 3</span>
<span class="co">#&gt;    year   qtr return</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1  2015     1   1.88</span>
<span class="co">#&gt; 2  2015     2   0.59</span>
<span class="co">#&gt; 3  2015     3   0.35</span>
<span class="co">#&gt; 4  2015     4   0.9 </span>
<span class="co">#&gt; 5  2016     1   1.1 </span>
<span class="co">#&gt; 6  2016     2   0.92</span>
<span class="co">#&gt; 7  2016     3   0.17</span>
<span class="co">#&gt; 8  2016     4   2.66</span></code></pre></div>

</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="relational-data.html"><span class="header-section-number">10</span> Relational Data</a></div>
<div class="next"><a href="list-of-datasets.html"><span class="header-section-number">A</span> List of Datasets</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#missing-data"><span class="header-section-number">11</span> Missing Data</a></li>
<li><a class="nav-link" href="#checking-for-missing-values"><span class="header-section-number">11.1</span> Checking for missing values</a></li>
<li><a class="nav-link" href="#cleaning-missing-values"><span class="header-section-number">11.2</span> Cleaning missing values</a></li>
<li><a class="nav-link" href="#operations-with-missing-values"><span class="header-section-number">11.3</span> Operations with Missing Values</a></li>
<li><a class="nav-link" href="#dropping-missing-values"><span class="header-section-number">11.4</span> Dropping Missing Values</a></li>
<li><a class="nav-link" href="#completing-missing-values"><span class="header-section-number">11.5</span> Completing Missing Values</a></li>
<li><a class="nav-link" href="#filling-missing-values"><span class="header-section-number">11.6</span> Filling Missing Values</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>IP2038 - Analysing Political and Economic Data in the Real World - Course Material</strong>" was written by Stefano Pagliari. It was last built on 2022-02-24.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
